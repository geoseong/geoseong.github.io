{"pageContext":{"notebook":"Dev","section":"node.js","page":{"id":"0-54e8daf087cbd644bd2b33101253494a!1-BC575AB8E2AB9833!1963","self":"https://www.onenote.com/api/v1.0/me/notes/pages/0-54e8daf087cbd644bd2b33101253494a!1-BC575AB8E2AB9833!1963","createdTime":"2017-07-03T13:46:31Z","title":"ExpressJS : 로그인-Redis , Passport, JWT","createdByAppId":"","links":{"oneNoteEmbedUrl":{"href":"https://onedrive.live.com/redir.aspx?cid=bc575ab8e2ab9833&page=edit&resid=BC575AB8E2AB9833!1937&parId=BC575AB8E2AB9833!109&wd=target%28node.js.one%7C1ea34b4b-f4ea-b841-ba6b-444db5441a6a%2FExpressJS%20%20%EB%A1%9C%EA%B7%B8%EC%9D%B8-Redis%20%2C%20Passport%2C%20JWT%20%7Cd1fe28f7-e0ee-9b48-bc87-543013b441a3%2F%29"},"oneNoteClientUrl":{"href":"onenote:https://d.docs.live.net/bc575ab8e2ab9833/Documents/Dev/node.js.one#ExpressJS%20%20%EB%A1%9C%EA%B7%B8%EC%9D%B8-Redis%20%2C%20Passport%2C%20JWT%20&section-id=1ea34b4b-f4ea-b841-ba6b-444db5441a6a&page-id=d1fe28f7-e0ee-9b48-bc87-543013b441a3&end"},"oneNoteWebUrl":{"href":"https://onedrive.live.com/redir.aspx?cid=bc575ab8e2ab9833&page=edit&resid=BC575AB8E2AB9833!1937&parId=BC575AB8E2AB9833!109&wd=target%28node.js.one%7C1ea34b4b-f4ea-b841-ba6b-444db5441a6a%2FExpressJS%20%20%EB%A1%9C%EA%B7%B8%EC%9D%B8-Redis%20%2C%20Passport%2C%20JWT%20%7Cd1fe28f7-e0ee-9b48-bc87-543013b441a3%2F%29"}},"contentUrl":"https://www.onenote.com/api/v1.0/me/notes/pages/0-54e8daf087cbd644bd2b33101253494a!1-BC575AB8E2AB9833!1963/content","lastModifiedTime":"2017-12-07T01:02:59Z","parentSection@odata.context":"https://www.onenote.com/api/v1.0/$metadata#me/notes/sections('0-BC575AB8E2AB9833%211963')/pages('0-54e8daf087cbd644bd2b33101253494a%211-BC575AB8E2AB9833%211963')/parentSection(id,name,self)/$entity","parentSection":{"id":"0-BC575AB8E2AB9833!1963","name":"node.js","self":"https://www.onenote.com/api/v1.0/me/notes/sections/0-BC575AB8E2AB9833!1963"},"content":"       http://webframeworks.kr/tutorials/expressjs/auth_log_in_out/#tocAnchor-1-4        Session, cookieParser 미들웨어 & Redis 서버 저장소        사용되는 것    Express.cookieParser    Express.session    Redis    Passport : Oauth 2.0방식, AccessToken을 사용함으로써 세션에 인증정보 저장 안해도 됨.    JWT(JSON Web Token)        세션 추가(메모리 용량 제한으로 내용이 유실될 수 있음)         app.use(express.cookieParser());     app.use(express.session({￼  key: ‘sid’, // 세션키￼  secret: ‘secret’, // 비밀키￼  cookie: {￼    maxAge: 1000 * 60 * 60 // 쿠키 유효기간 1시간￼  }￼}));     function (req, res) {￼  req.session.user_id = 1234, // 아이디￼  req.session.name = ‘chris’ // 이름￼}                 Redis연동 세션추가    var session = require('express-session’),￼  RedisStore = require('connect-redis')(session);￼    app.use(express.cookieParser());￼app.use(session({￼  store: new RedisStore(/*redis config: host, port 등*/), // 세션 저장소를 레디스 서버로 설정￼  /* 이하 express.session 코드와 동일 */￼}));        세션 삭제         exports.logout = function (req, res) {￼  req.session.destory();  // 세션 삭제￼  res.clearCookie(‘sid’); // 세션 쿠키 삭제￼};                  ","html":"\n\t\t<div style=\"position:absolute;left:48px;top:126px;width:642px\">\n\t\t\t<p style=\"margin-top:0pt;margin-bottom:0pt\"><a href=\"http://webframeworks.kr/tutorials/expressjs/auth_log_in_out/#tocAnchor-1-4\">http://webframeworks.kr/tutorials/expressjs/auth_log_in_out/#tocAnchor-1-4</a></p>\n\t\t\t<br>\n\t\t\t<h1 lang=\"en-US\" style=\"font-size:16pt;color:#1e4e79;margin-top:0pt;margin-bottom:0pt\"><span style=\"font-weight:bold\">Session, cookieParser </span><span lang=\"ko-KR\" style=\"font-weight:bold\">&#xBBF8;&#xB4E4;&#xC6E8;&#xC5B4;</span><span style=\"font-weight:bold\"> &amp; Redis </span><span lang=\"ko-KR\" style=\"font-weight:bold\">&#xC11C;&#xBC84;</span><span style=\"font-weight:bold\"> </span><span lang=\"ko-KR\" style=\"font-weight:bold\">&#xC800;&#xC7A5;&#xC18C;</span></h1>\n\t\t\t<br>\n\t\t\t<h1 style=\"font-size:16pt;color:#1e4e79;margin-top:0pt;margin-bottom:0pt\">&#xC0AC;&#xC6A9;&#xB418;&#xB294;<span lang=\"en-US\"> </span>&#xAC83;</h1>\n\t\t\t<h4 lang=\"en-US\" style=\"font-size:12pt;color:#5b9bd5;font-style:italic;margin-top:0pt;margin-bottom:0pt\"><span style=\"font-weight:bold\">Express.cookieParser</span></h4>\n\t\t\t<h4 lang=\"en-US\" style=\"font-size:12pt;color:#5b9bd5;font-style:italic;margin-top:0pt;margin-bottom:0pt\"><span style=\"font-weight:bold\">Express.session</span></h4>\n\t\t\t<h4 lang=\"en-US\" style=\"font-size:12pt;color:#5b9bd5;font-style:italic;margin-top:0pt;margin-bottom:0pt\"><span style=\"font-weight:bold\">Redis</span></h4>\n\t\t\t<h4 lang=\"en-US\" style=\"font-size:12pt;color:#5b9bd5;font-style:italic;margin-top:0pt;margin-bottom:0pt\"><span style=\"font-weight:bold\">Passport :</span> Oauth 2.0<span lang=\"ko-KR\">&#xBC29;&#xC2DD;</span>, AccessToken<span lang=\"ko-KR\">&#xC744;</span> <span lang=\"ko-KR\">&#xC0AC;&#xC6A9;&#xD568;&#xC73C;&#xB85C;&#xC368;</span> <span lang=\"ko-KR\">&#xC138;&#xC158;&#xC5D0;</span> <span lang=\"ko-KR\">&#xC778;&#xC99D;&#xC815;&#xBCF4;</span> <span lang=\"ko-KR\">&#xC800;&#xC7A5;</span> <span lang=\"ko-KR\">&#xC548;&#xD574;&#xB3C4;</span> <span lang=\"ko-KR\">&#xB428;</span>.</h4>\n\t\t\t<h4 lang=\"en-US\" style=\"font-size:12pt;color:#5b9bd5;font-style:italic;margin-top:0pt;margin-bottom:0pt\"><span style=\"font-weight:bold\">JWT(JSON Web Token)</span></h4>\n\t\t\t<br>\n\t\t\t<h3 style=\"font-size:12pt;color:#5b9bd5;margin-top:0pt;margin-bottom:0pt\">&#xC138;&#xC158;<span lang=\"en-US\"> </span>&#xCD94;&#xAC00;<span lang=\"en-US\">(</span>&#xBA54;&#xBAA8;&#xB9AC;<span lang=\"en-US\"> </span>&#xC6A9;&#xB7C9;<span lang=\"en-US\"> </span>&#xC81C;&#xD55C;&#xC73C;&#xB85C;<span lang=\"en-US\"> </span>&#xB0B4;&#xC6A9;&#xC774;<span lang=\"en-US\"> </span>&#xC720;&#xC2E4;&#xB420;<span lang=\"en-US\"> </span>&#xC218;<span lang=\"en-US\"> </span>&#xC788;&#xC74C;<span lang=\"en-US\">)</span></h3>\n\t\t\t<ul>\n\t\t\t\t<li><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">app.use(</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">express.cookieParser()</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">);</span></li>\n\t\t\t\t<li><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">app.use(</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">express.session({</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">&#xFFFC;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">  key: </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#a61717;font-weight:bold\">&#x2018;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">sid</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#a61717;font-weight:bold\">&#x2019;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">, </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#8d8d7e;font-weight:bold;font-style:italic\">// &#xC138;&#xC158;&#xD0A4;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">&#xFFFC;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">  secret: </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#a61717;font-weight:bold\">&#x2018;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">secret</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#a61717;font-weight:bold\">&#x2019;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">, </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#8d8d7e;font-weight:bold;font-style:italic\">// &#xBE44;&#xBC00;&#xD0A4;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">&#xFFFC;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">  cookie: {</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">&#xFFFC;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">    maxAge: </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#009999;font-weight:bold\">1000 </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">* </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#009999;font-weight:bold\">60 </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">* </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#009999;font-weight:bold\">60 </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#8d8d7e;font-weight:bold;font-style:italic\">// &#xCFE0;&#xD0A4; &#xC720;&#xD6A8;&#xAE30;&#xAC04; 1&#xC2DC;&#xAC04;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">&#xFFFC;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">  }</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">&#xFFFC;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">})</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">);</span></li>\n\t\t\t\t<li><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">function</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\"> (req, res) {</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">&#xFFFC;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">  req.session.user_id </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">=</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\"> </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#009999\">1234</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">, </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#8d8d7e;font-style:italic\">// &#xC544;&#xC774;&#xB514;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">&#xFFFC;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">  req.session.name </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">=</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\"> </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#a61717\">&#x2018;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">chris</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#a61717\">&#x2019;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\"> </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#8d8d7e;font-style:italic\">// &#xC774;&#xB984;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">&#xFFFC;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">}</span></li>\n\t\t\t\t<br>\n\t\t\t</ul>\n\t\t\t<br>\n\t\t\t<h3 lang=\"en-US\" style=\"font-size:12pt;color:#5b9bd5;margin-top:0pt;margin-bottom:0pt\"><span style=\"font-weight:bold;text-decoration:underline\">Redis</span><span lang=\"ko-KR\" style=\"font-weight:bold;text-decoration:underline\">&#xC5F0;&#xB3D9;</span><span style=\"font-weight:bold;text-decoration:underline\"> </span><span lang=\"ko-KR\" style=\"font-weight:bold;text-decoration:underline\">&#xC138;&#xC158;&#xCD94;&#xAC00;</span></h3>\n\t\t\t<p style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">var</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\"> session </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">=</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\"> require(</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#dd1144\">&apos;express-session&#x2019;),</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">&#xFFFC;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#dd1144\">  RedisStore = require(&apos;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">connect</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">-</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">redis</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#a61717\">&apos;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">)(session);</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">&#xFFFC;</span></p>\n\t\t\t<p style=\"margin-top:0pt;margin-bottom:7.5pt\"><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">app.use(express.cookieParser());</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">&#xFFFC;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">app.use(session({</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">&#xFFFC;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">  store</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">:</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\"> </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">new</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\"> RedisStore(</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#8d8d7e;font-style:italic\">/*redis config: host, port &#xB4F1;*/</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">), </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#8d8d7e;font-style:italic\">// &#xC138;&#xC158; &#xC800;&#xC7A5;&#xC18C;&#xB97C; &#xB808;&#xB514;&#xC2A4; &#xC11C;&#xBC84;&#xB85C; &#xC124;&#xC815;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">&#xFFFC;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">  </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#8d8d7e;font-style:italic\">/* &#xC774;&#xD558; express.session &#xCF54;&#xB4DC;&#xC640; &#xB3D9;&#xC77C; */</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">&#xFFFC;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">}));</span></p>\n\t\t\t<br>\n\t\t\t<h3 style=\"font-size:12pt;color:#5b9bd5;margin-top:0pt;margin-bottom:0pt\">&#xC138;&#xC158;<span lang=\"en-US\"> </span>&#xC0AD;&#xC81C;</h3>\n\t\t\t<ul>\n\t\t\t\t<li><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">exports.logout </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">=</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\"> </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333;font-weight:bold\">function</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\"> (req, res) {</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">&#xFFFC;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">  req.session.destory();  </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#8d8d7e;font-style:italic\">// &#xC138;&#xC158; &#xC0AD;&#xC81C;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">&#xFFFC;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">  res.clearCookie(</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#a61717\">&#x2018;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">sid</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#a61717\">&#x2019;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">); </span><span style=\"font-family:Menlo;font-size:9.5pt;color:#8d8d7e;font-style:italic\">// &#xC138;&#xC158; &#xCFE0;&#xD0A4; &#xC0AD;&#xC81C;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">&#xFFFC;</span><span style=\"font-family:Menlo;font-size:9.5pt;color:#333333\">};</span></li>\n\t\t\t</ul>\n\t\t\t<br>\n\t\t</div>\n\t\t<!-- InkNode is not supported -->\n\t\n\n"}}}