{"pageContext":{"notebook":"Web Dev","section":"Docker","page":{"id":"0-edc0214d599919488304aab66dcef4a2!1-BC575AB8E2AB9833!2141","self":"https://www.onenote.com/api/v1.0/me/notes/pages/0-edc0214d599919488304aab66dcef4a2!1-BC575AB8E2AB9833!2141","createdTime":"2018-10-26T08:52:52.941Z","title":"GitLab CI: Dockerfile로 환경변수 전달하기","createdByAppId":"","links":{"oneNoteEmbedUrl":{"href":"https://onedrive.live.com/redir.aspx?cid=bc575ab8e2ab9833&page=edit&resid=BC575AB8E2AB9833!1937&parId=BC575AB8E2AB9833!109&wd=target%28Docker.one%7Cc134cdbf-f311-3945-bbdb-f8eecc1a6d52%2FGitLab%20CI%20Dockerfile%EB%A1%9C%20%ED%99%98%EA%B2%BD%EB%B3%80%EC%88%98%20%EC%A0%84%EB%8B%AC%ED%95%98%EA%B8%B0%7C7df1d044-b8ec-a946-8ea3-87a01d341f09%2F%29"},"oneNoteClientUrl":{"href":"onenote:https://d.docs.live.net/bc575ab8e2ab9833/Documents/Web%20Dev/Docker.one#GitLab%20CI%20Dockerfile%EB%A1%9C%20%ED%99%98%EA%B2%BD%EB%B3%80%EC%88%98%20%EC%A0%84%EB%8B%AC%ED%95%98%EA%B8%B0&section-id=c134cdbf-f311-3945-bbdb-f8eecc1a6d52&page-id=7df1d044-b8ec-a946-8ea3-87a01d341f09&end"},"oneNoteWebUrl":{"href":"https://onedrive.live.com/redir.aspx?cid=bc575ab8e2ab9833&page=edit&resid=BC575AB8E2AB9833!1937&parId=BC575AB8E2AB9833!109&wd=target%28Docker.one%7Cc134cdbf-f311-3945-bbdb-f8eecc1a6d52%2FGitLab%20CI%20Dockerfile%EB%A1%9C%20%ED%99%98%EA%B2%BD%EB%B3%80%EC%88%98%20%EC%A0%84%EB%8B%AC%ED%95%98%EA%B8%B0%7C7df1d044-b8ec-a946-8ea3-87a01d341f09%2F%29"}},"contentUrl":"https://www.onenote.com/api/v1.0/me/notes/pages/0-edc0214d599919488304aab66dcef4a2!1-BC575AB8E2AB9833!2141/content","lastModifiedTime":"2019-02-12T05:50:19Z","parentSection@odata.context":"https://www.onenote.com/api/v1.0/$metadata#me/notes/sections('0-BC575AB8E2AB9833%212141')/pages('0-edc0214d599919488304aab66dcef4a2%211-BC575AB8E2AB9833%212141')/parentSection(id,name,self)/$entity","parentSection":{"id":"0-BC575AB8E2AB9833!2141","name":"Docker","self":"https://www.onenote.com/api/v1.0/me/notes/sections/0-BC575AB8E2AB9833!2141"},"content":"       방법1    https://gitlab.com/gitlab-org/gitlab-ce/issues/19327               test-docker-image2:        stage: test        image: docker:latest        variables:          DOCKER_DRIVER: overlay        script:          # We are running against, `docker: poorly formatted environment: variable '-----END CERTIFICATE-----' has white spaces.`          # So we are just getting rid of the whole `DOCKER_ENV_CI_SERVER_TLS_CA_FILE` entry,          # See related issue, https://github.com/mesosphere/marathon-lb/issues/433          - env | sed '/^DOCKER_ENV_CI_SERVER_TLS_CA_FILE=/,/^$/d' > .env          - docker pull selenium/standalone-chrome:3.4.0-francium          - docker run -d --env-file=.env selenium/standalone-chrome:3.4.0-francium        services:          - name: docker:dind        tags:          - docker          - shared                       방법2               variables:        AWS_ACCESS_KEY_ID: \"______\"        AWS_SECRET_ACCESS_KEY: \"______\"        S3_BUCKET_NAME: \"bucket_name_s3\"      …      build_aws:        # stage: build        only:          - geoseong        script:          - docker run --env AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID --env AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY -d --name geoseongimg dockerimg:latest aws s3 cp --recursive tmp/ s3://$S3_BUCKET_NAME --acl public-read                                ","html":"\n\t\t<div style=\"position:absolute;left:48px;top:139px;width:576px\">\n\t\t\t<h2 lang=\"ko-KR\" style=\"font-size:14pt;color:#2e75b5;margin-top:0pt;margin-bottom:0pt\"><span style=\"font-family:Malgun Gothic\">&#xBC29;&#xBC95;</span><span lang=\"en-US\">1</span></h2>\n\t\t\t<p style=\"margin-top:0pt;margin-bottom:0pt\"><a href=\"https://gitlab.com/gitlab-org/gitlab-ce/issues/19327\">https://gitlab.com/gitlab-org/gitlab-ce/issues/19327</a></p>\n\t\t\t<table style=\"border:1px solid;border-collapse:collapse\">\n\t\t\t\t<tbody><tr>\n\t\t\t\t\t<td style=\"background-color:black;border:1px solid\"><p lang=\"ko-KR\" style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"color:white\">test-docker-image2:</span></p>\n\t\t\t\t\t<p lang=\"ko-KR\" style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"color:white\">  stage: test</span></p>\n\t\t\t\t\t<p lang=\"ko-KR\" style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"color:white\">  image: docker:latest</span></p>\n\t\t\t\t\t<p lang=\"ko-KR\" style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"color:white\">  variables:</span></p>\n\t\t\t\t\t<p lang=\"ko-KR\" style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"color:white\">    DOCKER_DRIVER: overlay</span></p>\n\t\t\t\t\t<p lang=\"ko-KR\" style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"color:white\">  script:</span></p>\n\t\t\t\t\t<p lang=\"ko-KR\" style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"color:white\">    # We are running against, `docker: poorly formatted environment: variable &apos;-----END CERTIFICATE-----&apos; has white spaces.`</span></p>\n\t\t\t\t\t<p lang=\"ko-KR\" style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"color:white\">    # So we are just getting rid of the whole `DOCKER_ENV_CI_SERVER_TLS_CA_FILE` entry,</span></p>\n\t\t\t\t\t<p lang=\"ko-KR\" style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"color:white\">    # See related issue, </span><a href=\"https://github.com/mesosphere/marathon-lb/issues/433\" style=\"color:white\">https://github.com/mesosphere/marathon-lb/issues/433</a></p>\n\t\t\t\t\t<p lang=\"ko-KR\" style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"color:white\">    - env | sed &apos;/^DOCKER_ENV_CI_SERVER_TLS_CA_FILE=/,/^$/d&apos; &gt; .env</span></p>\n\t\t\t\t\t<p lang=\"ko-KR\" style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"color:white\">    - docker pull selenium/standalone-chrome:3.4.0-francium</span></p>\n\t\t\t\t\t<p lang=\"ko-KR\" style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"color:white\">    - docker run -d --env-file=.env selenium/standalone-chrome:3.4.0-francium</span></p>\n\t\t\t\t\t<p lang=\"ko-KR\" style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"color:white\">  services:</span></p>\n\t\t\t\t\t<p lang=\"ko-KR\" style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"color:white\">    - name: docker:dind</span></p>\n\t\t\t\t\t<p lang=\"ko-KR\" style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"color:white\">  tags:</span></p>\n\t\t\t\t\t<p lang=\"ko-KR\" style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"color:white\">    - docker</span></p>\n\t\t\t\t\t<p lang=\"ko-KR\" style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"color:white\">    - shared</span></p>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</tbody></table>\n\t\t\t<br>\n\t\t\t<h2 lang=\"ko-KR\" style=\"font-size:14pt;color:#2e75b5;margin-top:0pt;margin-bottom:0pt\"><span style=\"font-family:Malgun Gothic\">&#xBC29;&#xBC95;</span><span lang=\"en-US\">2</span></h2>\n\t\t\t<table style=\"border:1px solid;border-collapse:collapse\">\n\t\t\t\t<tbody><tr>\n\t\t\t\t\t<td style=\"background-color:black;border:1px solid\"><p lang=\"ko-KR\" style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"font-family:D2Coding;font-size:9pt;color:#569cd6\">variables</span><span style=\"font-family:D2Coding;font-size:9pt;color:#979797\">:</span></p>\n\t\t\t\t\t<p style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"font-family:D2Coding;font-size:9pt;color:#569cd6\">  </span><span lang=\"ko-KR\" style=\"font-family:D2Coding;font-size:9pt;color:#569cd6\">AWS_ACCESS_KEY_ID</span><span lang=\"ko-KR\" style=\"font-family:D2Coding;font-size:9pt;color:#979797\">: </span><span lang=\"ko-KR\" style=\"font-family:D2Coding;font-size:9pt;color:#cb8f76\">&quot;</span><span style=\"font-family:D2Coding;font-size:9pt;color:#979797\">______</span><span lang=\"ko-KR\" style=\"font-family:D2Coding;font-size:9pt;color:#cb8f76\">&quot;</span></p>\n\t\t\t\t\t<p style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"font-family:D2Coding;font-size:9pt;color:#569cd6\">  </span><span lang=\"ko-KR\" style=\"font-family:D2Coding;font-size:9pt;color:#569cd6\">AWS_SECRET_ACCESS_KEY</span><span lang=\"ko-KR\" style=\"font-family:D2Coding;font-size:9pt;color:#979797\">: </span><span lang=\"ko-KR\" style=\"font-family:D2Coding;font-size:9pt;color:#cb8f76\">&quot;</span><span style=\"font-family:D2Coding;font-size:9pt;color:#979797\">______</span><span lang=\"ko-KR\" style=\"font-family:D2Coding;font-size:9pt;color:#cb8f76\">&quot;</span></p>\n\t\t\t\t\t<p style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"font-family:D2Coding;font-size:9pt;color:#569cd6\">  </span><span lang=\"ko-KR\" style=\"font-family:D2Coding;font-size:9pt;color:#569cd6\">S3_BUCKET_NAME</span><span lang=\"ko-KR\" style=\"font-family:D2Coding;font-size:9pt;color:#979797\">: </span><span lang=\"ko-KR\" style=\"font-family:D2Coding;font-size:9pt;color:#cb8f76\">&quot;</span><span style=\"font-family:D2Coding;font-size:9pt;color:#cb8f76\">bucket_name_s3</span><span lang=\"ko-KR\" style=\"font-family:D2Coding;font-size:9pt;color:#cb8f76\">&quot;</span></p>\n\t\t\t\t\t<p style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"font-family:D2Coding;font-size:9pt;color:#cb8f76\">&#x2026;</span></p>\n\t\t\t\t\t<p lang=\"ko-KR\" style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"font-family:D2Coding;font-size:9pt;color:#569cd6\">build_aws</span><span lang=\"en-US\" style=\"font-family:D2Coding;font-size:9pt;color:#979797\">:</span></p>\n\t\t\t\t\t<p style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"font-family:D2Coding;font-size:9pt;color:#6a9955\">  </span><span lang=\"ko-KR\" style=\"font-family:D2Coding;font-size:9pt;color:#6a9955\"># stage: build</span></p>\n\t\t\t\t\t<p style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"font-family:D2Coding;font-size:9pt;color:#569cd6\">  </span><span lang=\"ko-KR\" style=\"font-family:D2Coding;font-size:9pt;color:#569cd6\">only</span><span style=\"font-family:D2Coding;font-size:9pt;color:#979797\">:</span></p>\n\t\t\t\t\t<p style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"font-family:D2Coding;font-size:9pt;color:#979797\">    </span><span lang=\"ko-KR\" style=\"font-family:D2Coding;font-size:9pt;color:#979797\">- </span><span style=\"font-family:D2Coding;font-size:9pt;color:#cb8f76\">geoseong</span></p>\n\t\t\t\t\t<p style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"font-family:D2Coding;font-size:9pt;color:#569cd6\">  </span><span lang=\"ko-KR\" style=\"font-family:D2Coding;font-size:9pt;color:#569cd6\">script</span><span style=\"font-family:D2Coding;font-size:9pt;color:#979797\">:</span></p>\n\t\t\t\t\t<p style=\"margin-top:0pt;margin-bottom:0pt\"><span style=\"font-family:D2Coding;font-size:9pt;color:#979797\">    </span><span lang=\"ko-KR\" style=\"font-family:D2Coding;font-size:9pt;color:#979797\">- </span><span style=\"font-family:D2Coding;font-size:9pt;color:#cb8f76\">docker run --env AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID --env AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY -d --name geoseongimg dockerimg:latest aws s3 cp --recursive tmp/ s3://$S3_BUCKET_NAME --acl public-read</span></p>\n\t\t\t\t\t<br>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</tbody></table>\n\t\t\t<br>\n\t\t</div>\n\t\n\n"}}}